# Interpretation of NWP model output - RCode
This repository contains R code that I used for the data analysis part of my master's thesis which was about the interpretation of point forecasts as state-dependent functionals following the work of Patrick Schmidt (Interpretation of Point Forecasts, 2019).


## Preliminaries
* R and R Studio installed
* R Packages used
    * tidyverse
    * PointFore
    * RMPI
    * snow
    * car
    * maptools
    * map
    * ggmap
    + ggplot2

## Data
The data used had the formate .Rdata, i.e., a dataframe in R, which contained the data column-wise. Specifically, each file contained 24h-ahead precipitation forecasts for 4019 days and corresponding TRMM observations for one location. There were in total 576 000 files that covered the globe in a 0.25 times 0.25 degree grid from -50 to 50 degrees of latitude.
Additionally, a file with meta-information was used that contained for each coordinate a boolean indicating if it is over land or ocean, a region and subregion.

## Functions

### Computations

#### EstimateFunctionalParallel.R
Goes through all the files applying the functions EstimateQuantiles and EstimateExpectiles to each file.

#### EstimateQuantiles.R / EstimateExpectiles.R
Given a file name of an .Rdata file as described above, these functions apply the function EstimateFunction from the package PointFore to that file and save the output in a new .Rdata file.

#### ExtractResultsAll.R
Goes through all the result files generated by EstimateQuantiles and EstimateExpectiles and applies GetResultsQuantiles and GetResultsExpectiles to each file such that the results can be put together and saved in one data frame for quantiles and expectiles, respectively.

#### GetResultsQuantiles.R / GetResultsExpectiles.R
Load a result file for quantiles and expectiles, respectively given a vector of coordinates and return a row vector of all important results such as values for theta1, theta2, the p-value of the J-test, the mean state and the 90 percentile of the state vector. Note: The p-value of the Wald-test is extracted separately in ExtractPWald.

#### ExtractPWald.R
Analogously to ExtractResultsAll. Applies GetPWaldQuantiles and GetPWaldExpectiles.

#### MeanResults.R
Averages all results i.e. values for theta1, theta2, p-values and states over 16 coordinates, respectively (i.e. a 4 times 4 grid) merging the results of 16 points into one.

### Plots

#### WorldPlotsQuantiles.R / WorldPlotsExpectiles.R
Plots the results generated by MeanResults for quantiles and expectiles into a map and saves the plots as pdf.
